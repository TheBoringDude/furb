{% extends 'layout.html' %}

{% block title %}
Grab {{manga}}
{% endblock title %}

{% block content %}
<div class="py-12 w-5/6 mx-auto">
    <div>
        <h1 class="text-xl font-black tracking-wide text-blue-600">furb</h1>
    </div>
    <hr>

    <div class="w-3/4 mx-auto py-2">
        <form action="/" method="POST">
            <label for="" class="text-lg font-light tracking-wide">Manhwa / Manga URL</label>
            <div class="flex items-center justify-center w-11/12 mx-auto py-1">
                <input type="text" name="url" class="py-1 px-2 text-lg border-b-2 font-thin tracking-wide mx-2 w-full text-blue-500 focus:border-blue-500 focus:outline-none" placeholder="Enter the url of the manga to grab..." value="{{query}}">
                <input type="submit" value="GRAB" class="py-1 px-6 bg-blue-500 hover:bg-blue-600 cursor-pointer tracking-wide rounded text-white">
            </div>
        </form>

        <div class="pt-6">
            <h4 class="font-light tracking-wide">Chapters:</h4>
            <hr class="my-3">
            <div class="w-11/12 mx-auto">
                <div class="flex items-center justify-between my-2">
                    <h3 class="font-light tracking-wide">Manga: <span class="text-blue-500 font-bold truncate">{{manga}}</span></h3>
                    <h3 class="font-light tracking-wide">Source: <span class="underline font-normal uppercase">{{source}}</span></h3>
                </div>
                <ul class="max-h-screen h-auto overflow-y-scroll p-2">
                    {% for chapter in results %}
                    <li class="flex items-center justify-between py-2 px-4 rounded bg-gray-100 font-light my-1">
                        <p class="w-full tracking-wide truncate">{{chapter.chapter_name}}</p>
                        <form action="" method="POST" id="form-gen-dl" key="{{chapter.chapter_url}}" onsubmit="generateDownload(event, this)">
                            <input type="hidden" name="chapter-url" value="{{chapter.b64_hash}}">
                            <button id="generate-dl"  type="submit" class="bg-green-600 opacity-75 hover:opacity-100 cursor-pointer text-white font-light rounded py-1 px-4 tracking-wider">Generate</button>
                        </form>
                    </li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock content %}

{% block ajax %}
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script>
    var _0x1bcb=['/download/q/','data','_blank','then','button','bg-green-600','open','disabled','link','classList','error','ERROR!','bg-green-500','catch','DOWNLOAD','Generating...','preventDefault','code','querySelector','innerHTML'];(function(_0x3f979d,_0x7da2a3){var _0x1bcb9c=function(_0x31925d){while(--_0x31925d){_0x3f979d['push'](_0x3f979d['shift']());}};_0x1bcb9c(++_0x7da2a3);}(_0x1bcb,0x10b));var _0x3192=function(_0x3f979d,_0x7da2a3){_0x3f979d=_0x3f979d-0x14c;var _0x1bcb9c=_0x1bcb[_0x3f979d];return _0x1bcb9c;};function generateDownload(_0x43a850,_0x1b57f7){var _0x4a7cd5=_0x3192;_0x43a850[_0x4a7cd5(0x155)]();var _0x5a54a0=_0x1b57f7[_0x4a7cd5(0x157)](_0x4a7cd5(0x15d));_0x5a54a0[_0x4a7cd5(0x158)]=_0x4a7cd5(0x154),_0x5a54a0[_0x4a7cd5(0x14c)]=!![];const _0x58e1e4=_0x1b57f7['chapter-url']['value'];let _0x5730ba={};axios['post']('/get/q/'+_0x58e1e4)[_0x4a7cd5(0x15c)](_0x3a3866=>{var _0x40499d=_0x4a7cd5;if(_0x3a3866['status']!==0xc8||_0x3a3866[_0x40499d(0x15a)][_0x40499d(0x156)]!==0xc8){_0x5a54a0['disabled']=!![],_0x5a54a0[_0x40499d(0x158)]=_0x40499d(0x150);return;}data=_0x3a3866['data'],_0x5730ba={'title':data[_0x40499d(0x15a)]['title'],'dl_link':data[_0x40499d(0x15a)][_0x40499d(0x14d)]},_0x5a54a0['type']=_0x40499d(0x15d),_0x5a54a0['disabled']=![],_0x5a54a0['innerHTML']=_0x40499d(0x153),_0x5a54a0[_0x40499d(0x14e)]['remove'](_0x40499d(0x15e)),_0x5a54a0[_0x40499d(0x14e)]['add'](_0x40499d(0x151));})[_0x4a7cd5(0x152)](_0x33cc4a=>{var _0x386d2a=_0x4a7cd5;console[_0x386d2a(0x14f)](_0x33cc4a);}),_0x5a54a0['onclick']=()=>{var _0x2b4967=_0x4a7cd5;_0x5730ba&&window[_0x2b4967(0x15f)](_0x2b4967(0x159)+window['btoa'](JSON['stringify'](_0x5730ba)),_0x2b4967(0x15b));};}
</script>
{% endblock ajax %}